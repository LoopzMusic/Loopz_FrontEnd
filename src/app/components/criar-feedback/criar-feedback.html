
<div class="card p-4">
  <h5 class="mb-3">Deixe sua Avaliação</h5>
  
  <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()">
   
    <div class="mb-3">
      <label class="form-label">Sua avaliação *</label>
      <div class="d-flex gap-2 mb-2">
        @for (estrela of getEstrelas(5); track estrela) {
          <i 
            class="bi fs-4 cursor-pointer"
            [class.bi-star-fill]="feedbackForm.get('nuAvaliacao')?.value >= estrela"
            [class.bi-star]="feedbackForm.get('nuAvaliacao')?.value < estrela"
            [class.text-warning]="feedbackForm.get('nuAvaliacao')?.value >= estrela"
            [class.text-muted]="feedbackForm.get('nuAvaliacao')?.value < estrela"
            (click)="selecionarAvaliacao(estrela)"
            style="cursor: pointer;">
          </i>
        }
      </div>
      
      <div *ngIf="feedbackForm.get('nuAvaliacao')?.invalid && 
                  feedbackForm.get('nuAvaliacao')?.touched" 
           class="text-danger small">
        Selecione uma avaliação de 1 a 5 estrelas
      </div>
    </div>

    
    <div class="mb-3">
      <label class="form-label">Comentário (opcional)</label>
      <textarea 
        class="form-control" 
        formControlName="dsComentario" 
        rows="4"
        maxlength="500"
        placeholder="Compartilhe sua experiência com este produto...">
      </textarea>
      <small class="text-muted">
        {{ caracteresDigitados }}/500 caracteres
      </small>
      
      <div *ngIf="feedbackForm.get('dsComentario')?.invalid && 
                  feedbackForm.get('dsComentario')?.touched" 
           class="text-danger small">
        O comentário não pode ter mais de 500 caracteres
      </div>
    </div>

    
    <button 
      type="submit" 
      class="btn btn-primary"
      [disabled]="feedbackForm.invalid || enviando">
      <span *ngIf="!enviando">
        <i class="bi bi-send me-2"></i>Enviar Avaliação
      </span>
      <span *ngIf="enviando">
        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
        Enviando...
      </span>
    </button>

    
    <div *ngIf="mensagemSucesso" class="alert alert-success mt-3 mb-0">
      <i class="bi bi-check-circle-fill me-2"></i>{{ mensagemSucesso }}
    </div>

    
    <div *ngIf="mensagemErro" class="alert alert-danger mt-3 mb-0">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ mensagemErro }}
    </div>
  </form>
</div>