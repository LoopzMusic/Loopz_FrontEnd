<div class="cadastro-container d-flex justify-content-center align-items-center p-3 p-md-5">
  <app-toast
    [show]="toast.show"
    [message]="toast.message"
    [type]="toast.type"
    (closed)="toast.show = false"
  ></app-toast>

  <div
    class="cadastro-card p-4 p-md-5 shadow-lg border rounded"
    style="width: 100%; max-width: 700px"
  >
    <h1 class="title text-center mb-2">Criar Conta</h1>
    <p class="subtitle text-center text-muted mb-4">
      Preencha os dados abaixo para criar sua conta
    </p>

    <form [formGroup]="cadastroForm" (ngSubmit)="onSubmit()">
      <div class="section-header d-flex align-items-center gap-2 pb-2 border-bottom mb-4 mt-4">
        <h2 class="mb-0 fs-5 fw-semibold">Informações Pessoais</h2>
      </div>

      <div class="mb-3">
        <label class="form-label">Nome Completo *</label>
        <input
          type="text"
          class="form-control"
          formControlName="nmCliente"
          [class.is-invalid]="
            cadastroForm.get('nmCliente')?.invalid && cadastroForm.get('nmCliente')?.touched
          "
        />
        @if (cadastroForm.get('nmCliente')?.invalid && cadastroForm.get('nmCliente')?.touched) {
        <div class="text-danger small mt-1">Nome é obrigatório (mínimo 3 caracteres)</div>
        }
      </div>

      <div class="section-header d-flex align-items-center gap-2 pb-2 border-bottom mb-4 mt-4">
        <h2 class="mb-0 fs-5 fw-semibold">Contato</h2>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">E-mail *</label>
          <input
            type="email"
            class="form-control"
            formControlName="dsEmail"
            [class.is-invalid]="
              cadastroForm.get('dsEmail')?.invalid && cadastroForm.get('dsEmail')?.touched
            "
          />
          @if (cadastroForm.get('dsEmail')?.invalid && cadastroForm.get('dsEmail')?.touched) {
          <div class="text-danger small mt-1">E-mail inválido</div>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Telefone *</label>
          <input
            type="text"
            class="form-control"
            formControlName="nuTelefone"
            (input)="formatTelefone($event)"
            (paste)="formatTelefone($event)"
            [class.is-invalid]="
              cadastroForm.get('nuTelefone')?.invalid && cadastroForm.get('nuTelefone')?.touched
            "
          />
          @if (cadastroForm.get('nuTelefone')?.invalid && cadastroForm.get('nuTelefone')?.touched) {
          <div class="text-danger small mt-1">Telefone é obrigatório</div>
          }
        </div>
      </div>

      <div class="section-header d-flex align-items-center gap-2 pb-2 border-bottom mb-4 mt-4">
        <h2 class="mb-0 fs-5 fw-semibold">Endereço</h2>
      </div>

      <div class="row">
        <div class="col-md-8 mb-3">
          <label class="form-label">CEP *</label>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              [class.is-invalid]="
                cadastroForm.get('nuCEP')?.invalid && cadastroForm.get('nuCEP')?.touched
              "
              formControlName="nuCEP"
              (input)="formatCEP($event)"
              placeholder="00000-000"
              maxlength="9"
            />

            <button type="button" class="btn btn-outline-dark" (click)="buscarCEP()">
              Buscar CEP
            </button>
          </div>

          @if (cadastroForm.get('nuCEP')?.invalid && cadastroForm.get('nuCEP')?.touched) {
          <div class="text-danger small mt-1">CEP obrigatório (8 dígitos)</div>
          }
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Estado *</label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="
              cadastroForm.get('dsEstado')?.invalid && cadastroForm.get('dsEstado')?.touched
            "
            formControlName="dsEstado"
          />

          @if (cadastroForm.get('dsEstado')?.invalid && cadastroForm.get('dsEstado')?.touched) {
          <div class="text-danger small mt-1">Estado obrigatório</div>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Cidade *</label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="
              cadastroForm.get('dsCidade')?.invalid && cadastroForm.get('dsCidade')?.touched
            "
            formControlName="dsCidade"
          />

          @if (cadastroForm.get('dsCidade')?.invalid && cadastroForm.get('dsCidade')?.touched) {
          <div class="text-danger small mt-1">Cidade obrigatória</div>
          }
        </div>
      </div>

      <div class="row">
        <div class="col-md-8 mb-3">
          <label class="form-label">Endereço *</label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="
              cadastroForm.get('dsEndereco')?.invalid && cadastroForm.get('dsEndereco')?.touched
            "
            formControlName="dsEndereco"
          />

          @if (cadastroForm.get('dsEndereco')?.invalid && cadastroForm.get('dsEndereco')?.touched) {
          <div class="text-danger small mt-1">Endereço obrigatório</div>
          }
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Número *</label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="
              cadastroForm.get('nuEndereco')?.invalid && cadastroForm.get('nuEndereco')?.touched
            "
            formControlName="nuEndereco"
          />

          @if (cadastroForm.get('nuEndereco')?.invalid && cadastroForm.get('nuEndereco')?.touched) {
          <div class="text-danger small mt-1">Número obrigatório</div>
          }
        </div>
      </div>

      <div class="section-header d-flex align-items-center gap-2 pb-2 border-bottom mb-4 mt-4">
        <h2 class="mb-0 fs-5 fw-semibold">Dados de Acesso</h2>
      </div>

      <div class="mb-3">
        <label for="nuCPF" class="form-label">CPF *</label>
        <input
          type="text"
          id="nuCPF"
          class="form-control"
          formControlName="nuCPF"
          (input)="formatCPF($event)"
          placeholder="000.000.000-00"
          maxlength="14"
          [class.is-invalid]="
            cadastroForm.get('nuCPF')?.invalid && cadastroForm.get('nuCPF')?.touched
          "
        />

        @if (cadastroForm.get('nuCPF')?.hasError('cpfInvalido')) {
        <div class="text-danger small mt-1">CPF inválido.</div>
        } @if (cadastroForm.get('nuCPF')?.hasError('required') &&
        cadastroForm.get('nuCPF')?.touched) {
        <div class="text-danger small mt-1">CPF é obrigatório.</div>
        }
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Senha *</label>
          <input
            type="password"
            class="form-control"
            formControlName="dsSenha"
            [class.is-invalid]="
              cadastroForm.get('dsSenha')?.invalid && cadastroForm.get('dsSenha')?.touched
            "
          />
          @if (cadastroForm.get('dsSenha')?.invalid && cadastroForm.get('dsSenha')?.touched) {
          <div class="text-danger small mt-1">Senha deve ter no mínimo 8 caracteres</div>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Confirmar Senha *</label>
          <input
            type="password"
            class="form-control"
            formControlName="confirmaSenha"
            [class.is-invalid]="
              cadastroForm.get('confirmaSenha')?.invalid &&
              cadastroForm.get('confirmaSenha')?.touched
            "
          />
          @if (cadastroForm.get('confirmaSenha')?.hasError('passwordMismatch')) {
          <div class="text-danger small mt-1">As senhas não coincidem</div>
          }
        </div>
      </div>

      <button type="submit" class="btn btn-cadastrar w-100 py-3 fw-semibold" [disabled]="isLoading">
        @if (!isLoading) {
        <span>Cadastrar</span>
        } @if (isLoading) {
        <span><span class="spinner-border spinner-border-sm me-2"></span>Cadastrando...</span>
        }
      </button>
    </form>

    <p class="login-link text-center mt-4 mb-0">
      Já tem conta?
      <a (click)="navigateToLogin()" class="fw-semibold cursor-pointer">Fazer login</a>
    </p>
  </div>
</div>
