@if (carregando) {
<div class="container mt-4">
  <div class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3">Carregando perfil...</p>
  </div>
</div>
} @if (!carregando && usuario) {
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold">Meu Perfil</h4>

    <div class="d-flex gap-2">
      @if (!modoEdicao) {
      <button class="btn btn-dark px-4" (click)="ativarEdicao()">
        <i class="bi bi-pencil me-2"></i>Editar Informações
      </button>
      } @if (modoEdicao) {
      <button
        class="btn btn-dark px-4"
        (click)="cancelarEdicao()"
        [disabled]="salvando"
      >
        <i class="bi bi-x-lg me-2"></i>Cancelar
      </button>
      <button class="btn btn-success px-4" (click)="salvarAlteracoes()" [disabled]="salvando">
        @if (salvando) {
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        } @if (!salvando) {
        <i class="bi bi-check-lg me-2"></i>
        } Salvar
      </button>
      }
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h6 class="fw-bold mb-3">
        <i class="bi bi-person-fill me-1"></i>
        Informações Pessoais
      </h6>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nome Completo</label>
          <input class="form-control" [(ngModel)]="usuario.nmCliente" [disabled]="!modoEdicao" />
        </div>

        <div class="col-md-6">
          <label class="form-label">CPF</label>
          <input
            class="form-control"
            [(ngModel)]="usuario.nuCPF"
            [disabled]="!modoEdicao"
            [class.is-invalid]="cpfInvalido && modoEdicao"
            [class.is-valid]="!cpfInvalido && modoEdicao && usuario.nuCPF"
            (input)="formatarCPF()"
            (blur)="validarCPF()"
            maxlength="14"
            placeholder="000.000.000-00"
          />
          @if (cpfInvalido && modoEdicao) {
          <div class="invalid-feedback d-block">CPF inválido! Verifique os números digitados.</div>
          } @if (!cpfInvalido && modoEdicao && usuario.nuCPF) {
          <div class="valid-feedback d-block">CPF válido ✓</div>
          }
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h6 class="fw-bold mb-3">
        <i class="bi bi-telephone-fill me-1"></i>
        Contato
      </h6>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">E-mail</label>
          <input class="form-control" [(ngModel)]="usuario.dsEmail" [disabled]="!modoEdicao" />
        </div>

        <div class="col-md-6">
          <label class="form-label">Telefone</label>
          <input class="form-control" [(ngModel)]="usuario.nuTelefone" [disabled]="!modoEdicao" />
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h6 class="fw-bold mb-3">
        <i class="bi bi-geo-alt-fill me-1"></i>
        Endereço
      </h6>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Estado</label>
          <input class="form-control" [(ngModel)]="usuario.dsEstado" [disabled]="!modoEdicao" />
        </div>

        <div class="col-md-6">
          <label class="form-label">Cidade</label>
          <input class="form-control" [(ngModel)]="usuario.dsCidade" [disabled]="!modoEdicao" />
        </div>

        <div class="col-md-8">
          <label class="form-label">Endereço</label>
          <input class="form-control" [(ngModel)]="usuario.dsEndereco" [disabled]="!modoEdicao" />
        </div>

        <div class="col-md-4">
          <label class="form-label">Número</label>
          <input class="form-control" [(ngModel)]="usuario.nuEndereco" [disabled]="!modoEdicao" />
        </div>
      </div>
    </div>
  </div>
</div>
} @if (!carregando && !usuario) {
<div class="container mt-4">
  <div class="alert alert-warning" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Não foi possível carregar os dados do usuário.
  </div>
</div>
}

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div
    #toastPerfil
    class="toast align-items-center text-bg-success border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">Mensagem aqui</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
</div>
